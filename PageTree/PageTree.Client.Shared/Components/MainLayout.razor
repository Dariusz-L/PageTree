@using Common.Basic.Collections;
@using PageTree.Client.Shared.Pages
@inherits LayoutComponentBase
@inject NavigationManager Navigation

<div class="page">
    @if (IsJapaneseArcanaHome())
    {
        <main>
            <article class="main-content">
                @Body
            </article>
            @{
                var links = new string[][]
                {
                    new[] {"Learn", "learn" },
                    new[] {"Contact", "contact" },
                };
            }
            <div><TopOrSideMenu Links="@links" /></div>
        </main>
    }
    else
    @if (IsJapaneseArcanaLearn())
    {
        <main>
            <article class="main-content pl-5">
                @Body
            </article>
             @{
                var links = new string[][]
                {
                    new[] {"Pages", "pages" },
                };
            }
            <div><TopOrSideMenu Links="@links" SideOnly=true/></div>
        </main>
    }
    else
    @if (IsPageTreeLearn())
    {
        <PTNavMenu />
        <main>
            <div class="top-row"><PTLearnNavBar /></div>
            <article class="main-content pl-5">
                @Body
            </article>
        </main>
    }
    else
    @if (IsPageTreeHome())
    {
        <main>
            <div class="top-row"><PTHomeNavBar /></div>
            <article class="main-content pl-5">
                @Body
            </article>
        </main>
    }

    <LoadingScreen/>
</div>

@code {
    private readonly static string LearnRoute = "learn";
    private readonly static string PageTreeRoute = "pagetree";

    private string _baseUri;
    private string _currentUri;

    protected override void OnInitialized()
    {
        Navigation.LocationChanged += OnLocationChanged;
        _baseUri = Navigation.BaseUri;
        _currentUri = Navigation.Uri;
    }

    private bool IsJapaneseArcanaHome() =>
        _currentUri == _baseUri;

    private bool IsJapaneseArcanaLearn() =>
        _currentUri.ToLower().StartsWith($"{_baseUri}{LearnRoute}");

    private bool IsPageTreeHome() =>
        _currentUri.ToLower().StartsWith($"{_baseUri}{PageTreeRoute}");

    private bool IsPageTreeLearn() =>
        _currentUri.ToLower().StartsWith($"{_baseUri}{PageTreeRoute}/{LearnRoute}");

    private void OnLocationChanged(object sender, LocationChangedEventArgs args)
    {
        _baseUri = Navigation.BaseUri;
        _currentUri = args.Location;
        InvokeAsync(StateHasChanged);
    }
}
